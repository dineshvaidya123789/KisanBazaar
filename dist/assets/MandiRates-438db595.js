import{u as Q,r as s,k as X,j as e,_ as E}from"./index-8bfef425.js";import{L as Z}from"./LocationSelector-7327b6a3.js";import{B as ee}from"./BackToHomeButton-2549dd6c.js";import{S as te}from"./SEO-d9799b97.js";const ae=()=>{const{t:r}=Q(),[T,R]=s.useState(""),[d,D]=s.useState(""),[a,w]=s.useState(""),[m,B]=s.useState([]),[W,M]=s.useState(!1),[f,C]=s.useState(""),[F,z]=s.useState(!1),[I,N]=s.useState(!1),[$,S]=s.useState(!1),[c,p]=s.useState(""),u=s.useRef(null);s.useEffect(()=>{a?(z(!0),P(a)):d&&(z(!0),P(d))},[a,d]);const P=async t=>{M(!0);try{const x=X(t).map((i,y)=>({id:y+1,crop:i.name,min:i.min,max:i.max,avg:Math.round((i.min+i.max)/2),unit:i.unit||"Qtl",trend:Math.random()>.5?"up":"down"}));B(x)}catch(o){console.error("Failed to fetch mandi rates",o),B([])}finally{M(!1)}},U=()=>{if(W)return e.jsxs("div",{className:"card",style:{padding:"3rem",textAlign:"center"},children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{style:{marginTop:"1rem",color:"#666"},children:r("loading_rates")||"Loading..."})]});if(!F)return e.jsxs("div",{style:{textAlign:"center",padding:"3rem",backgroundColor:"#fff",borderRadius:"var(--radius-lg)",border:"2px dashed #cbd5e1"},children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem",opacity:.5},children:"ðŸ”Ž"}),e.jsx("h3",{style:{color:"#64748b",marginBottom:"0.5rem"},children:r("select_mandi_prompt")}),e.jsx("p",{style:{color:"#94a3b8"},children:r("search_btn")?r("select_mandi_prompt"):"Select location and click Search"})]});if(m.length===0)return e.jsxs("div",{style:{textAlign:"center",padding:"3rem",backgroundColor:"#fff",borderRadius:"var(--radius-lg)",border:"2px dashed #cbd5e1"},children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem",opacity:.5},children:"ðŸƒ"}),e.jsx("h3",{style:{color:"#64748b",marginBottom:"0.5rem"},children:r("no_results")||"No rates found"}),e.jsx("p",{style:{color:"#94a3b8"},children:"Try selecting a different mandi or district."})]});const t=m.filter(o=>o.crop.toLowerCase().includes(f.toLowerCase()));return e.jsxs("div",{className:"card",style:{overflow:"hidden",padding:0},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-secondary)",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("h3",{style:{margin:0},children:[a||d," Market"]}),e.jsxs("span",{style:{fontSize:"0.9rem"},children:["ðŸ“… ",new Date().toLocaleDateString("en-IN")]})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:"600px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f8fafc",borderBottom:"2px solid #e2e8f0"},children:[e.jsx("th",{style:{padding:"1rem",textAlign:"left",color:"#475569"},children:r("crop")}),e.jsx("th",{style:{padding:"1rem",textAlign:"center",color:"#475569"},children:"Unit"}),e.jsxs("th",{style:{padding:"1rem",textAlign:"right",color:"#16a34a"},children:[r("min_price")," (â‚¹)"]}),e.jsxs("th",{style:{padding:"1rem",textAlign:"right",color:"#dc2626"},children:[r("max_price")," (â‚¹)"]}),e.jsxs("th",{style:{padding:"1rem",textAlign:"right",color:"#2563eb"},children:[r("avg_price")," (â‚¹)"]})]})}),e.jsx("tbody",{children:t.length>0?t.map((o,x)=>e.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0",backgroundColor:x%2===0?"white":"#f8fafc"},children:[e.jsx("td",{style:{padding:"1rem",fontWeight:"500"},children:o.crop}),e.jsx("td",{style:{padding:"1rem",textAlign:"center",color:"#666"},children:o.unit}),e.jsx("td",{style:{padding:"1rem",textAlign:"right",fontWeight:"600"},children:o.min}),e.jsx("td",{style:{padding:"1rem",textAlign:"right",fontWeight:"600"},children:o.max}),e.jsx("td",{style:{padding:"1rem",textAlign:"right",fontWeight:"bold"},children:o.avg})]},o.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:r("no_results")||"No crops found matching search"})})})]})})]})},H=()=>{if(!navigator.geolocation){alert(r("geolocation_unsupported")||"Geolocation is not supported by your browser");return}p("detecting"),navigator.geolocation.getCurrentPosition(async t=>{const{latitude:o,longitude:x}=t.coords;try{const i=await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${o}&lon=${x}&zoom=10`,{headers:{"Accept-Language":"en-US,en;q=0.9","User-Agent":"KisanBazaar-Mobile-App"}});if(!i.ok)throw new Error("Network error");const y=await i.json();if(y&&y.address){const l=y.address,G=l.state||"",Y=l.city||l.district||l.county||l.state_district||"",k=l.suburb||l.town||l.village||l.neighbourhood||l.city_district||"",{getCityToDistrict:V}=await E(()=>import("./locationMapping-e858de36.js"),[]),{getStates:q,getDistricts:J,getTehsils:K}=await E(()=>import("./index-8bfef425.js").then(h=>h.J),["assets/index-8bfef425.js","assets/index-2cd76cb2.css"]);let L=V(Y),g=q().find(h=>h.toLowerCase()===G.toLowerCase())||"",n="",b="";if(g){const h=J(g);n=h.find(v=>v.toLowerCase()===L.toLowerCase())||"",n||(n=h.find(v=>v.toLowerCase().includes(L.toLowerCase())||L.toLowerCase().includes(v.toLowerCase()))||""),n&&(b=K(g,n).find(A=>A.toLowerCase()===k.toLowerCase()||A.toLowerCase().includes(k.toLowerCase())||k.toLowerCase().includes(A.toLowerCase()))||"")}g&&R(g),n&&D(n),b?w(b):n&&w(n),p("success");const j=[];b&&j.push(b),n&&j.push(n),g&&j.push(g),j.length>0?alert(`ðŸ“ Location detected: ${j.join(", ")}

Rates will load automatically.`):alert("ðŸ“ Location detected but could not match to our database. Please select manually.")}else throw new Error("Address not found")}catch(i){p("error"),alert("Unable to connect to location service. Please select manually."),console.error("Reverse Geocoding error:",i)}finally{p("")}},t=>{t.code===1?(p("permission_denied"),setTimeout(()=>p(""),3e3)):(p("error"),alert("Unable to detect location. Please select manually."),p("")),console.error("Geolocation error:",t)},{timeout:15e3,enableHighAccuracy:!0})},_=m.filter(t=>t.crop.toLowerCase().includes(f.toLowerCase())),O={"@context":"https://schema.org","@type":"Table",about:`Mandi Rates for ${a||d||"Madhya Pradesh"}`,mainEntity:_.map(t=>({"@type":"Product",name:t.crop,offers:{"@type":"Ofter",price:t.avg,priceCurrency:"INR",availability:"https://schema.org/InStock",seller:{"@type":"Organization",name:`${a||d} Mandi`}}}))};return e.jsxs("div",{className:"container fade-in",style:{padding:"var(--spacing-xl) 0"},children:[e.jsx(te,{title:r("todays_rates")+(a?` - ${a}`:""),description:"Check daily mandi rates for all crops.",schema:O}),e.jsx("h1",{style:{textAlign:"center",marginBottom:"var(--spacing-md)",color:"var(--color-primary)"},children:r("todays_rates")}),e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:"1rem",marginBottom:"1.5rem"},children:e.jsxs("button",{className:"btn btn-outline",onClick:()=>S(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:["ðŸ“Š ",r("view_analysis")||"View Analysis"]})}),e.jsx("div",{className:"card",style:{marginBottom:"var(--spacing-lg)",padding:"1.5rem",backgroundColor:"#f0f9ff"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.8rem"},children:[e.jsxs("label",{style:{fontWeight:"600",color:"#1e293b",margin:0},children:[r("select_location"),":"]}),e.jsx("button",{type:"button",onClick:H,disabled:c==="detecting",style:{padding:"0.4rem 0.8rem",fontSize:"0.9rem",whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:"0.4rem",backgroundColor:c==="detecting"?"#f1f5f9":c==="permission_denied"?"#fee2e2":"#dcfce7",color:c==="detecting"?"#94a3b8":c==="permission_denied"?"#dc2626":"#166534",border:c==="permission_denied"?"1px solid #fca5a5":"1px solid #86efac",borderRadius:"6px",cursor:c==="detecting"?"not-allowed":"pointer",fontWeight:"600"},children:c==="detecting"?e.jsx(e.Fragment,{children:"â³ Detecting..."}):c==="permission_denied"?e.jsx(e.Fragment,{children:"ðŸš« Permission Denied"}):e.jsxs(e.Fragment,{children:["ðŸ“ ",r("nearby_mandi")||"Nearby Mandi"]})})]}),e.jsx("div",{style:{width:"100%"},children:e.jsx(Z,{stateRef:u,selectedState:T,selectedDistrict:d,selectedTehsil:a,onLocationChange:t=>{t.state&&R(t.state),t.district&&D(t.district),w(t.tehsil||"")},showTehsil:!0})})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600",color:"#1e293b"},children:[r("search_crop"),":"]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",width:"100%",borderRadius:"var(--radius-md)",border:"1px solid #cbd5e1",backgroundColor:"white",overflow:"hidden",boxShadow:I?"0 0 0 3px rgba(34, 197, 94, 0.1)":"none",transition:"box-shadow 0.2s"},children:[e.jsx("span",{style:{paddingLeft:"12px",fontSize:"1.2rem",opacity:.6},children:"ðŸ”"}),e.jsx("input",{type:"text",placeholder:r("search_placeholder")||"Search crops...",value:f,onChange:t=>C(t.target.value),onFocus:t=>{if(!T&&!d){t.preventDefault(),t.target.blur(),alert(r("select_location_first")||"Please select a State and District first to see rates."),u.current&&(u.current.focus(),u.current.style.borderColor="red",setTimeout(()=>u.current.style.borderColor="#ccc",1e3));return}N(!0)},onBlur:()=>setTimeout(()=>N(!1),200),style:{width:"100%",padding:"0.8rem 0.5rem",border:"none",outline:"none",fontSize:"1rem",background:"transparent"}}),f&&e.jsx("button",{onClick:()=>C(""),style:{background:"none",border:"none",cursor:"pointer",padding:"0 12px",fontSize:"1.2rem",color:"#94a3b8",display:"flex",alignItems:"center",height:"100%",transition:"color 0.2s"},title:"Clear",onMouseEnter:t=>t.target.style.color="#475569",onMouseLeave:t=>t.target.style.color="#94a3b8",children:"Ã—"})]}),I&&f&&_.length>0&&e.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"0 0 8px 8px",marginTop:"4px",zIndex:10,boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)",maxHeight:"250px",overflowY:"auto",animation:"slideDown 0.2s ease-out"},children:[e.jsx("style",{children:`
                                        @keyframes slideDown {
                                            from { opacity: 0; transform: translateY(-10px); }
                                            to { opacity: 1; transform: translateY(0); }
                                        }
                                    `}),_.map(t=>e.jsxs("div",{onClick:()=>C(t.crop),style:{padding:"12px 16px",cursor:"pointer",borderBottom:"1px solid #f1f5f9",fontSize:"0.95rem",display:"flex",justifyContent:"space-between",alignItems:"center"},onMouseEnter:o=>o.currentTarget.style.backgroundColor="#f8fafc",onMouseLeave:o=>o.currentTarget.style.backgroundColor="white",children:[e.jsx("span",{style:{fontWeight:"500",color:"#334155"},children:t.crop}),e.jsxs("span",{style:{fontSize:"0.8rem",color:"#64748b",backgroundColor:"#f1f5f9",padding:"2px 8px",borderRadius:"12px"},children:["â‚¹",t.avg,"/",t.unit]})]},t.id))]})]})]})]})}),U(),$&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>S(!1),children:e.jsxs("div",{style:{backgroundColor:"white",padding:"2rem",borderRadius:"12px",maxWidth:"500px",width:"90%",maxHeight:"80vh",overflowY:"auto"},onClick:t=>t.stopPropagation(),children:[e.jsxs("h2",{style:{marginTop:0},children:["ðŸ“Š ",r("market_analysis_title")||"Market Analysis"," (",a||d||"General",")"]}),e.jsx("p",{style:{color:"#666"},children:r("price_trends_desc")||"Price trends for top commodities."}),e.jsxs("div",{style:{marginTop:"1rem"},children:[m.slice(0,5).map(t=>e.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"1rem",borderBottom:"1px solid #eee"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("strong",{children:t.crop}),e.jsx("span",{style:{color:t.trend==="up"?"green":"red",backgroundColor:t.trend==="up"?"#e8f5e9":"#ffebee",padding:"2px 8px",borderRadius:"4px",fontSize:"0.8rem"},children:t.trend==="up"?r("trending_up")||"Trending Up":r("trending_down")||"Trending Down"})]}),e.jsx("div",{style:{fontSize:"0.9rem",color:"#555",marginTop:"4px"},children:r("avg_price_fmt",{price:t.avg,unit:t.unit}).replace("{price}",t.avg).replace("{unit}",t.unit)||`Avg: ${t.avg}`})]},t.id)),m.length===0&&e.jsx("p",{children:r("analysis_no_data")||"No data available."})]}),e.jsx("button",{className:"btn",onClick:()=>S(!1),style:{width:"100%",marginTop:"1rem",backgroundColor:"#f1f5f9",color:"#333"},children:r("close")||"Close"})]})}),e.jsx(ee,{})]})};export{ae as default};
