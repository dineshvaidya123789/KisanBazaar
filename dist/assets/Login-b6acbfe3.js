import{r as i,a as E,u as L,i as N,m as W,j as e}from"./index-d4578f9c.js";import{S as A}from"./SEO-b28265a0.js";const q=()=>{var x,f;const[b,d]=i.useState(1),[a,v]=i.useState(""),[p,j]=i.useState(""),[m,S]=i.useState(""),[u,o]=i.useState(""),[s,l]=i.useState(!1),[w,_]=i.useState(null);i.useEffect(()=>{try{h()}catch(n){console.warn("Recaptcha Init Warning:",n)}return()=>{if(window.recaptchaVerifier){try{window.recaptchaVerifier.clear()}catch(n){console.warn("Recaptcha Cleanup Warning:",n)}window.recaptchaVerifier=null}}},[]);const{login:R,verifyOtp:C,setupRecaptcha:h,createUser:B}=E(),{t:r}=L(),O=N(),V=((f=(x=W().state)==null?void 0:x.from)==null?void 0:f.pathname)||"/",g=n=>{const t=["०","१","२","३","४","५","६","७","८","९"];return n.split("").map(c=>{const y=t.indexOf(c);return y>-1?y:c}).join("")},k=async n=>{if(n.preventDefault(),o(""),a.length<10){o(r("error_invalid_phone")||"Please enter a valid 10-digit number.");return}l(!0);try{let t=window.recaptchaVerifier;t||(t=h());const c=await R(a,t);_(c),d(2)}catch(t){console.error(t),o(`Error: ${t.code||t.message||"Failed to send OTP"}`),window.recaptchaVerifier&&window.recaptchaVerifier.reset}finally{l(!1)}},z=async n=>{n.preventDefault(),l(!0),o("");try{const t=await C(w,p);await B(t.uid,{phone:a,city:m,role:"Farmer"}),O(V,{replace:!0})}catch(t){console.error(t),o("Invalid OTP. Please check via SMS.")}finally{l(!1)}};return e.jsxs("div",{className:"container fade-in",style:{padding:"var(--spacing-xl) 0",display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:[e.jsx(A,{title:r("login_title"),description:"Secure login for farmers and buyers."}),e.jsxs("div",{className:"card",style:{maxWidth:"400px",width:"100%",padding:"2rem"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"2rem"},children:[e.jsx("h1",{style:{color:"var(--color-primary)"},children:r("login_title")}),e.jsx("p",{style:{color:"#666"},children:r("login_subtitle")})]}),u&&e.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"0.8rem",borderRadius:"4px",marginBottom:"1rem",textAlign:"center"},children:u}),e.jsx("div",{id:"recaptcha-container"}),b===1?e.jsxs("form",{onSubmit:k,children:[e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold"},children:r("label_city")}),e.jsx("input",{type:"text",value:m,onChange:n=>S(n.target.value),placeholder:r("placeholder_city"),style:{width:"100%",padding:"0.8rem",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold"},children:r("label_phone")}),e.jsxs("div",{style:{display:"flex"},children:[e.jsx("span",{style:{padding:"0.8rem",backgroundColor:"#f0f0f0",border:"1px solid #ccc",borderRight:"none",borderRadius:"4px 0 0 4px",color:"#555"},children:"+91"}),e.jsx("input",{type:"tel",value:a,onChange:n=>{const t=g(n.target.value);v(t.replace(/\D/g,""))},placeholder:r("placeholder_phone"),maxLength:"10",style:{flex:1,padding:"0.8rem",borderRadius:"0 4px 4px 0",border:"1px solid #ccc",fontSize:"1rem"},required:!0})]})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",style:{width:"100%",fontSize:"1.1rem",padding:"1rem"},disabled:s,children:r(s?"btn_sending":"btn_get_otp")})]}):e.jsxs("form",{onSubmit:z,children:[e.jsxs("p",{style:{textAlign:"center",marginBottom:"1rem",color:"#555"},children:[r("otp_sent_to")," ",e.jsxs("strong",{children:["+91 ",a]}),e.jsx("br",{}),e.jsx("span",{style:{fontSize:"0.8rem",color:"var(--color-primary)",cursor:"pointer",textDecoration:"underline"},onClick:()=>d(1),children:r("change_number")})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold"},children:r("label_enter_otp")}),e.jsx("input",{type:"text",value:p,onChange:n=>{const t=g(n.target.value);j(t)},placeholder:r("placeholder_otp"),style:{width:"100%",padding:"0.8rem",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1.2rem",textAlign:"center",letterSpacing:"5px"},required:!0})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",style:{width:"100%",fontSize:"1.1rem",padding:"1rem"},disabled:s,children:r(s?"btn_verifying":"btn_verify_login")})]})]})]})};export{q as default};
