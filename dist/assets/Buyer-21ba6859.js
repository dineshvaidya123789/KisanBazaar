import{u as z,e as _,a as G,r as o,j as e,R as M,f as X,g as T,L as C,h as J}from"./index-0a05ca76.js";const L=({initialCommodity:t="",onSuccess:s})=>{const{t:a}=z(),{addBuyerRequest:r}=_(),{user:c}=G(),[b,n]=o.useState(t),[y,l]=o.useState(""),[f,p]=o.useState("kg"),[m,h]=o.useState(""),[j,x]=o.useState(!1),u=async g=>{if(g.preventDefault(),!c){alert(a("login_required")||"Please login first");return}x(!0);try{await r({commodity:b,quantity:y,unit:f,expectedPrice:m,status:"open",buyerName:c.name||"Anonymous",buyerPhone:c.phone||"",location:c.location||c.city||""}),n(""),l(""),h(""),alert("Request posted successfully!"),s&&s()}catch{alert("Failed to post request. Try again.")}finally{x(!1)}};return e.jsxs("div",{className:"card fade-in",style:{border:"2px solid var(--color-secondary)",background:"#F0FDF4"},children:[e.jsxs("h3",{style:{color:"var(--color-secondary)",marginBottom:"1rem"},children:["ðŸ“ ",a("post_buyer_request")||"Post a Request"]}),e.jsx("p",{style:{fontSize:"0.9rem",marginBottom:"1rem",color:"#555"},children:a("cant_find_item")||"Can't find what you need? Post a request and sellers will contact you."}),e.jsxs("form",{onSubmit:u,children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.85rem",marginBottom:"4px",fontWeight:"bold"},children:a("commodity")||"Commodity"}),e.jsx("input",{type:"text",value:b,onChange:g=>n(g.target.value),placeholder:"e.g. Onion, Wheat",required:!0,style:{width:"100%",padding:"8px",borderRadius:"4px",border:"1px solid #ccc"}})]}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"1rem"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",fontSize:"0.85rem",marginBottom:"4px",fontWeight:"bold"},children:a("quantity")||"Quantity"}),e.jsx("input",{type:"number",value:y,onChange:g=>l(g.target.value),placeholder:"e.g. 50",required:!0,style:{width:"100%",padding:"8px",borderRadius:"4px",border:"1px solid #ccc"}})]}),e.jsxs("div",{style:{width:"80px"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.85rem",marginBottom:"4px",fontWeight:"bold"},children:a("unit")||"Unit"}),e.jsxs("select",{value:f,onChange:g=>p(g.target.value),style:{width:"100%",padding:"8px",borderRadius:"4px",border:"1px solid #ccc"},children:[e.jsx("option",{value:"kg",children:"Kg"}),e.jsx("option",{value:"quintal",children:"Quintal"}),e.jsx("option",{value:"ton",children:"Ton"})]})]})]}),e.jsx("button",{type:"submit",className:"btn",disabled:j,style:{width:"100%",background:"var(--color-secondary)",color:"white",fontWeight:"bold"},children:j?"Posting...":a("submit_request")||"Post Request"})]})]})},Z=M.memo(({product:t})=>{const{t:s,language:a}=z(),r=t[`title_${a}`]||t[`title_${a==="hi"?"hi":"en"}`]||t.title||t.commodity||"Unknown Product",c=t.location||t.district||"Unknown Location",b=t.price||t.targetPrice||"0",n=t.unit||t.priceUnit||"unit",y=t.quantity||"0",l=t.seller||"Unknown Seller",f=Array.isArray(t.images)&&t.images.length>0&&t.images[0],p=t.image&&typeof t.image=="string"&&t.image.length>5,m=f?t.images:p?[t.image]:[],h=m.length>0?m[0]:null,j=t[`description_${a}`]||t.description||t.comments||"No description available",x=t.category||"Others";return e.jsxs("div",{className:"card",style:{display:"flex",flexDirection:"column",height:"100%",padding:"0",overflow:"hidden"},children:[e.jsxs("div",{style:{height:"200px",backgroundColor:"#eee",position:"relative"},children:[h?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:h,alt:r,style:{width:"100%",height:"100%",objectFit:"cover"},loading:"lazy"}),m.length>1&&e.jsxs("div",{style:{position:"absolute",bottom:"10px",right:"10px",background:"rgba(0,0,0,0.6)",color:"white",padding:"3px 8px",borderRadius:"4px",fontSize:"0.8rem",fontWeight:"bold"},children:["+",m.length-1," Photos"]})]}):e.jsxs("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"#94a3b8",background:"#f8fafc",borderBottom:"1px solid #eee"},children:[e.jsx("div",{style:{fontSize:"3rem"},children:"ðŸ“¦"}),e.jsx("div",{style:{fontSize:"0.9rem",marginTop:"8px",fontWeight:"500"},children:s("no_photo")})]}),e.jsx("span",{style:{position:"absolute",top:"10px",left:"10px",backgroundColor:t.type==="Buy"?"#D32F2F":"#1E4A35",color:"white",padding:"4px 10px",borderRadius:"20px",fontSize:"0.75rem",fontWeight:"bold",textTransform:"uppercase"},children:t.type==="Buy"?s("want_to_buy"):s("want_to_sell")}),e.jsx("span",{style:{position:"absolute",top:"10px",right:"10px",backgroundColor:"rgba(0,0,0,0.6)",color:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"0.8rem"},children:c})]}),e.jsxs("div",{style:{padding:"var(--spacing-md)",flex:1,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"8px"},children:[e.jsx("h3",{style:{fontSize:"1.2rem",margin:0},children:r}),e.jsx("span",{style:{backgroundColor:"#E8F5E9",color:"var(--color-primary-light)",padding:"2px 8px",borderRadius:"10px",fontSize:"0.8rem",fontWeight:"600"},children:x})]}),e.jsx("p",{style:{color:"var(--color-text-light)",fontSize:"0.9rem",marginBottom:"8px",flex:1},children:j}),e.jsxs("div",{style:{marginBottom:"var(--spacing-md)",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsxs("span",{style:{fontSize:"0.85rem",color:"#666"},children:["ðŸ‘¤ ",l]}),t.sellerVerified&&e.jsxs("span",{style:{fontSize:"0.75rem",color:"#4CAF50",fontWeight:"600",display:"flex",alignItems:"center",gap:"2px"},children:["âœ“ ",s("verified")]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"var(--spacing-md)"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{display:"block",fontSize:"0.8rem",color:"#888"},children:(t.type==="Buy",s("price"))}),e.jsxs("span",{style:{fontSize:"1.2rem",fontWeight:"bold",color:t.type==="Buy"?"#D32F2F":"var(--color-primary)"},children:["â‚¹",b,e.jsxs("span",{style:{fontSize:"0.9rem",color:"#666",fontWeight:"normal"},children:["/",n]})]})]}),e.jsxs("div",{children:[e.jsx("span",{style:{display:"block",fontSize:"0.8rem",color:"#888"},children:t.type==="Buy"?s("needed"):s("available")}),e.jsxs("span",{style:{fontWeight:"500"},children:[y," ",n]})]})]}),t.type==="Sell"&&t.quality&&e.jsxs("div",{style:{marginBottom:"12px",fontSize:"0.85rem",color:"#666",backgroundColor:"#f9f9f9",padding:"6px 10px",borderRadius:"4px",borderLeft:"3px solid #4CAF50"},children:[e.jsxs("strong",{children:[s("quality"),":"]})," ",t.quality]}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("a",{href:t.contactMobile?`tel:${t.contactMobile}`:"#",className:"btn btn-outline",style:{flex:1,textDecoration:"none",display:"flex",alignItems:"center",justifyContent:"center"},onClick:u=>{t.contactMobile||(u.preventDefault(),alert("Contact number not available for this listing."))},children:["ðŸ“ž ",s("call_now")]}),e.jsxs("a",{href:t.contactMobile?`https://wa.me/${t.contactMobile}?text=Hi, I am interested in your ${r} listing on KisanBazaar.`:"#",target:"_blank",rel:"noopener noreferrer",className:"btn",style:{flex:1,backgroundColor:"#25D366",color:"white",borderColor:"#25D366",display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none"},onClick:u=>{t.contactMobile||(u.preventDefault(),alert("Contact number not available for this listing."))},children:["ðŸ’¬ ",s("whatsapp")]})]})]})]})}),re=()=>{const{buyerPosts:t,sellerListings:s,loading:a}=_(),{t:r}=z(),[c]=X(),b=c.get("tab")==="sell"?"sell":"buy",[n,y]=o.useState(b),[l,f]=o.useState(""),[p,m]=o.useState("All"),[h,j]=o.useState({min:0,max:1e5}),[x,u]=o.useState(!1),[g,v]=o.useState(!1),{addAlert:E}=_(),[B,R]=o.useState(!1),[O,w]=o.useState(!1),[k,W]=o.useState(""),F=async i=>{if(i){R(!0);try{await E({commodity:i,maxPrice:h.max,userId:localStorage.getItem("userMobile")||"anonymous",type:"sell_alert",channel:"app"}),alert(r("alert_set_success").replace("{crop}",i)),W(""),w(!1)}catch{alert(r("error_general"))}finally{R(!1)}}};o.useEffect(()=>{window.scrollTo(0,0)},[]);const $=M.useMemo(()=>{const i=new Set([...Object.keys(T),...Object.values(T)]);return Array.from(i).sort()},[]),q=(()=>(n==="buy"?s:t).filter(d=>{var A,P,D;const S=l.toLowerCase(),H=J(S),Q=!l||((A=d.commodity)==null?void 0:A.toLowerCase().includes(S))||((P=d.location)==null?void 0:P.toLowerCase().includes(S))||((D=d.title)==null?void 0:D.toLowerCase().includes(S))||H.some(V=>{var N;return(N=d.commodity)==null?void 0:N.toLowerCase().includes(V)}),Y=p==="All"||d.category===p;let I=parseFloat(d.price||d.expectedPrice||0);const K=I>=h.min&&I<=h.max;return Q&&Y&&K}))(),U=[{id:"All",icon:"ðŸŒ¾",label:r("filter_all")},{id:"Vegetables",icon:"ðŸ…",label:r("filter_veg")},{id:"Fruits",icon:"ðŸ¥­",label:r("filter_fruits")},{id:"Grains",icon:"ðŸŒ¾",label:r("filter_grains")}];return e.jsxs("div",{className:"buyer-page fade-in",style:{paddingBottom:"80px"},children:[e.jsxs("div",{className:"page-header",style:{background:"linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%)",color:"white",padding:"var(--spacing-xl) var(--spacing-md)",textAlign:"center",borderRadius:"0 0 var(--radius-lg) var(--radius-lg)",marginBottom:"var(--spacing-lg)",boxShadow:"0 4px 20px rgba(46, 125, 50, 0.2)",position:"relative"},children:[e.jsxs(C,{to:"/",style:{position:"absolute",top:"20px",left:"20px",color:"white",textDecoration:"none",fontWeight:"bold",display:"flex",alignItems:"center",gap:"5px",background:"rgba(255,255,255,0.2)",padding:"5px 10px",borderRadius:"20px",fontSize:"0.9rem"},children:["â† ",r("back_to_home")||"Home"]}),e.jsx("h1",{style:{marginBottom:"8px",fontSize:"2rem"},children:r("marketplace_title")}),e.jsx("p",{style:{color:"rgba(255, 255, 255, 0.9)",fontSize:"1.1rem"},children:r("buy_sell_hub")}),n==="buy"?e.jsxs("button",{onClick:()=>v(!0),className:"btn fade-in",style:{marginTop:"1rem",background:"rgba(255, 255, 255, 0.2)",backdropFilter:"blur(5px)",border:"1px solid rgba(255,255,255,0.4)",color:"white",padding:"8px 16px",borderRadius:"20px",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer"},children:["ðŸ“ ",r("post_buyer_request")||"Post a Request"]}):e.jsxs(C,{to:"/sell",className:"btn fade-in",style:{marginTop:"1rem",background:"rgba(255, 255, 255, 0.2)",backdropFilter:"blur(5px)",border:"1px solid rgba(255,255,255,0.4)",color:"white",padding:"8px 16px",borderRadius:"20px",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer",textDecoration:"none",display:"inline-block"},children:["ðŸ“¸ ",r("list_product")||"List Your Crop"]}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",marginTop:"2rem",background:"rgba(255, 255, 255, 0.15)",padding:"6px",borderRadius:"var(--radius-xl)",maxWidth:"400px",margin:"2rem auto 0",backdropFilter:"blur(10px)"},children:[e.jsxs("button",{onClick:()=>y("buy"),style:{flex:1,padding:"12px 24px",borderRadius:"var(--radius-lg)",background:n==="buy"?"white":"transparent",color:n==="buy"?"var(--color-primary)":"white",border:"none",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxShadow:n==="buy"?"0 4px 12px rgba(0,0,0,0.1)":"none"},children:[e.jsx("span",{style:{fontSize:"1.2rem"},children:"ðŸ›’"})," ",r("i_want_buy")]}),e.jsxs("button",{onClick:()=>y("sell"),style:{flex:1,padding:"12px 24px",borderRadius:"var(--radius-lg)",background:n==="sell"?"white":"transparent",color:n==="sell"?"var(--color-secondary)":"white",border:"none",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxShadow:n==="sell"?"0 4px 12px rgba(0,0,0,0.1)":"none"},children:[e.jsx("span",{style:{fontSize:"1.2rem"},children:"ðŸšœ"})," ",r("i_want_sell")]})]})]}),e.jsxs("div",{className:"container",children:[g&&e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx(L,{onSuccess:()=>v(!1)}),e.jsx("div",{style:{textAlign:"center",marginTop:"10px"},children:e.jsx("button",{onClick:()=>v(!1),style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer"},children:r("close")||"Close"})})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:"var(--spacing-lg)",position:"sticky",top:"80px",zIndex:10,flexWrap:"wrap"},children:[e.jsxs("div",{style:{flex:1,position:"relative",minWidth:"280px"},children:[e.jsx("input",{type:"text",list:"marketplace-suggestions",placeholder:r("search_placeholder"),value:l,onChange:i=>f(i.target.value),style:{width:"100%",padding:"1rem 1rem 1rem 3rem",borderRadius:"var(--radius-xl)",border:"1px solid #e0e0e0",boxShadow:"0 4px 12px rgba(0,0,0,0.05)",fontSize:"1rem"}}),e.jsx("datalist",{id:"marketplace-suggestions",children:$.map((i,d)=>e.jsx("option",{value:i},d))}),e.jsx("span",{style:{position:"absolute",left:"1rem",top:"50%",transform:"translateY(-50%)",fontSize:"1.2rem",color:"#666"},children:"ðŸ”"}),e.jsx("button",{onClick:()=>{l?F(l):w(!0)},title:r("notify_me_tooltip"),style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",background:"transparent",border:"none",fontSize:"1.2rem",cursor:"pointer",padding:"5px",borderRadius:"50%",transition:"background 0.2s"},onMouseOver:i=>i.target.style.background="#f0f0f0",onMouseOut:i=>i.target.style.background="transparent",children:"ðŸ””"})]}),e.jsxs("button",{className:"btn",onClick:()=>u(!x),style:{background:x?"var(--color-primary)":"white",color:x?"white":"var(--color-primary)",border:"1px solid var(--color-primary)",borderRadius:"var(--radius-xl)",padding:"0 1.5rem",display:"flex",alignItems:"center",gap:"8px",fontWeight:"600"},children:[e.jsx("span",{children:"âš™ï¸"})," ",r("filters")]})]}),x&&e.jsxs("div",{className:"fade-in",style:{background:"white",padding:"1.5rem",borderRadius:"var(--radius-lg)",marginBottom:"var(--spacing-lg)",boxShadow:"var(--shadow-md)",border:"1px solid #eee"},children:[e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500",color:"#666"},children:r("category")}),e.jsx("div",{style:{display:"flex",gap:"10px",overflowX:"auto",paddingBottom:"4px"},children:U.map(i=>e.jsxs("button",{onClick:()=>m(i.id),style:{padding:"8px 16px",borderRadius:"20px",border:`1px solid ${p===i.id?"var(--color-primary)":"#ddd"}`,background:p===i.id?"#e8f5e9":"white",color:p===i.id?"var(--color-primary)":"#666",cursor:"pointer",whiteSpace:"nowrap",transition:"all 0.2s"},children:[i.icon," ",i.label]},i.id))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500",color:"#666"},children:r("price_range")}),e.jsx("input",{type:"range",min:"0",max:"100000",step:"1000",style:{width:"100%",accentColor:"var(--color-primary)"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px",fontSize:"0.9rem",color:"#666"},children:[e.jsx("span",{children:"â‚¹0"}),e.jsx("span",{children:"â‚¹1,00,000+"})]})]})]}),a?e.jsxs("div",{style:{display:"flex",justifyContent:"center",padding:"4rem"},children:[e.jsx("div",{className:"spinner"}),e.jsx("style",{children:`
                            .spinner {
                                border: 4px solid #f3f3f3;
                                border-top: 4px solid var(--color-primary);
                                border-radius: 50%;
                                width: 40px;
                                height: 40px;
                                animation: spin 1s linear infinite;
                            }
                            @keyframes spin {
                                0% { transform: rotate(0deg); }
                                100% { transform: rotate(360deg); }
                            }
                        `})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"var(--spacing-lg)"},children:q.length===0?e.jsxs("div",{style:{gridColumn:"1/-1",textAlign:"center",padding:"4rem 2rem",color:"#666"},children:[e.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem",opacity:.5},children:"ðŸƒ"}),e.jsx("h3",{children:r("no_posts_found")}),e.jsx("p",{children:r("try_adjusting_filters")}),e.jsxs("div",{style:{marginTop:"2rem",maxWidth:"500px",margin:"2rem auto"},children:[e.jsx("p",{style:{fontWeight:"bold",color:"var(--color-primary)"},children:r("cant_find_item")||"Can't find what you need?"}),e.jsx(L,{initialCommodity:l})]})]}):q.map(i=>e.jsx(Z,{product:i},i.id))}),e.jsx("div",{style:{textAlign:"center",marginTop:"3rem",marginBottom:"1rem"},children:e.jsxs(C,{to:"/",className:"btn btn-outline",style:{padding:"0.8rem 2rem",fontSize:"1rem"},children:["ðŸ  ",r("back_to_home")||"Back to Home"]})})]}),O&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>w(!1),children:e.jsxs("div",{style:{background:"white",padding:"2rem",borderRadius:"12px",width:"90%",maxWidth:"400px"},onClick:i=>i.stopPropagation(),children:[e.jsxs("h3",{children:["ðŸ”” ",r("set_alert_title")]}),e.jsx("p",{children:r("set_alert_desc")}),e.jsx("input",{type:"text",placeholder:r("search_placeholder"),value:k,onChange:i=>W(i.target.value),style:{width:"100%",padding:"10px",marginBottom:"1rem",borderRadius:"8px",border:"1px solid #ccc"}}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>F(k),className:"btn btn-primary",style:{flex:1},disabled:!k||B,children:r(B?"loading":"set_alert_btn")}),e.jsx("button",{onClick:()=>w(!1),className:"btn btn-outline",style:{flex:1},children:r("cancel")})]})]})})]})]})};export{re as default};
