import{a as L,e as C,r as n,E as g,F as y,G as f,H as j,j as e,N as D,b}from"./index-1e834adc.js";import{S as z}from"./SEO-de1f2544.js";const M=()=>{const{user:h,loading:u}=L(),{listings:o,deleteListing:A}=C(),[a,S]=n.useState(""),[s,p]=n.useState("listings"),[c,v]=n.useState([]),[m,w]=n.useState([]);if(n.useEffect(()=>{const t=g(f(b,"alerts"),y("timestamp","desc")),r=j(t,i=>{const d=i.docs.map(l=>({id:l.id,...l.data()}));v(d)});return()=>r()},[]),n.useEffect(()=>{const t=g(f(b,"users"),y("createdAt","desc")),r=j(t,i=>{const d=i.docs.map(l=>({uid:l.id,...l.data()}));w(d)});return()=>r()},[]),u)return e.jsx("div",{children:"Loading..."});if(!h||h.role!=="Admin")return e.jsx(D,{to:"/",replace:!0});const x=o.map(t=>({id:t.id,type:t.type,title:t.commodity||t.title,user:t.seller||t.contactName,mobile:t.contactMobile,date:new Date(t.timestamp||Date.now()).toLocaleDateString(),price:t.targetPrice?`${t.targetPrice}/${t.priceUnit}`:"Market",location:`${t.district||""}, ${t.state||""}`})).filter(t=>{var r,i,d;return((r=t.title)==null?void 0:r.toLowerCase().includes(a.toLowerCase()))||((i=t.mobile)==null?void 0:i.includes(a))||((d=t.user)==null?void 0:d.toLowerCase().includes(a.toLowerCase()))}),k=async(t,r)=>{window.confirm(`Are you sure you want to delete listing for "${r}"?`)&&await A(t)};return e.jsxs("div",{className:"container",style:{padding:"2rem 0"},children:[e.jsx(z,{title:"Admin Dashboard",description:"Admin management area"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem"},children:[e.jsx("h1",{style:{color:"#1e293b"},children:"ðŸ›¡ï¸ Admin Dashboard"}),e.jsxs("div",{style:{padding:"0.5rem 1rem",background:"#e2e8f0",borderRadius:"8px",fontWeight:"bold"},children:["Admin: ",h.phone]})]}),e.jsxs("div",{className:"card",style:{padding:"1.5rem",marginBottom:"2rem"},children:[e.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:"1.5rem",borderBottom:"2px solid #e2e8f0"},children:[e.jsxs("button",{onClick:()=>p("listings"),style:{padding:"0.75rem 1.5rem",background:"none",border:"none",borderBottom:s==="listings"?"3px solid #3b82f6":"3px solid transparent",color:s==="listings"?"#3b82f6":"#64748b",fontWeight:s==="listings"?"bold":"normal",cursor:"pointer",fontSize:"1rem"},children:["ðŸ“‹ Listings (",o.length,")"]}),e.jsxs("button",{onClick:()=>p("alerts"),style:{padding:"0.75rem 1.5rem",background:"none",border:"none",borderBottom:s==="alerts"?"3px solid #3b82f6":"3px solid transparent",color:s==="alerts"?"#3b82f6":"#64748b",fontWeight:s==="alerts"?"bold":"normal",cursor:"pointer",fontSize:"1rem"},children:["ðŸ”” Alerts (",c.length,")"]}),e.jsxs("button",{onClick:()=>p("users"),style:{padding:"0.75rem 1.5rem",background:"none",border:"none",borderBottom:s==="users"?"3px solid #3b82f6":"3px solid transparent",color:s==="users"?"#3b82f6":"#64748b",fontWeight:s==="users"?"bold":"normal",cursor:"pointer",fontSize:"1rem"},children:["ðŸ‘¥ Users (",m.length,")"]})]}),e.jsxs("div",{style:{display:"flex",gap:"2rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{flex:1,minWidth:"200px",padding:"1rem",background:"#eff6ff",borderRadius:"8px"},children:[e.jsx("h3",{style:{margin:0,color:"#1e40af"},children:"Total Listings"}),e.jsx("p",{style:{fontSize:"2rem",fontWeight:"bold",margin:"0.5rem 0"},children:o.length})]}),e.jsxs("div",{style:{flex:1,minWidth:"200px",padding:"1rem",background:"#fef3c7",borderRadius:"8px"},children:[e.jsx("h3",{style:{margin:0,color:"#92400e"},children:"Active Alerts"}),e.jsx("p",{style:{fontSize:"2rem",fontWeight:"bold",margin:"0.5rem 0"},children:c.length})]})]})]}),e.jsxs("div",{className:"card",style:{padding:"0",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"1rem",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.jsx("h3",{style:{margin:0},children:s==="listings"?"Moderation Queue":"Active Alerts"}),s==="listings"&&e.jsx("input",{type:"text",placeholder:"Search by crop, name, mobile...",value:a,onChange:t=>S(t.target.value),style:{padding:"0.5rem",borderRadius:"4px",border:"1px solid #cbd5e1",width:"300px"}})]}),s==="listings"?e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",textAlign:"left"},children:[e.jsx("thead",{style:{background:"#f8fafc",color:"#64748b",fontSize:"0.9rem"},children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"1rem"},children:"Date"}),e.jsx("th",{style:{padding:"1rem"},children:"Type"}),e.jsx("th",{style:{padding:"1rem"},children:"Commodity"}),e.jsx("th",{style:{padding:"1rem"},children:"User (Mobile)"}),e.jsx("th",{style:{padding:"1rem"},children:"Location"}),e.jsx("th",{style:{padding:"1rem",textAlign:"center"},children:"Actions"})]})}),e.jsx("tbody",{children:x.length>0?x.map(t=>e.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0"},children:[e.jsx("td",{style:{padding:"1rem"},children:t.date}),e.jsx("td",{style:{padding:"1rem"},children:e.jsx("span",{style:{padding:"2px 8px",borderRadius:"12px",fontSize:"0.8rem",background:t.type==="Buy"?"#fee2e2":"#dcfce7",color:t.type==="Buy"?"#dc2626":"#166534"},children:t.type})}),e.jsx("td",{style:{padding:"1rem",fontWeight:"500"},children:t.title}),e.jsxs("td",{style:{padding:"1rem"},children:[e.jsx("div",{children:t.user}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#666"},children:t.mobile})]}),e.jsx("td",{style:{padding:"1rem",fontSize:"0.9rem",color:"#475569"},children:t.location}),e.jsx("td",{style:{padding:"1rem",textAlign:"center"},children:e.jsx("button",{onClick:()=>k(t.id,t.title),style:{background:"#fee2e2",color:"#dc2626",border:"1px solid #fca5a5",padding:"4px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:"Delete"})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",style:{padding:"2rem",textAlign:"center",color:"#94a3b8"},children:"No listings found matching search."})})})]})}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",textAlign:"left"},children:[e.jsx("thead",{style:{background:"#f8fafc",color:"#64748b",fontSize:"0.9rem"},children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"1rem"},children:"Date Created"}),e.jsx("th",{style:{padding:"1rem"},children:"Commodity"}),e.jsx("th",{style:{padding:"1rem"},children:"User (Mobile)"}),e.jsx("th",{style:{padding:"1rem"},children:"Max Price"}),e.jsx("th",{style:{padding:"1rem"},children:"Location Filter"}),e.jsx("th",{style:{padding:"1rem"},children:"Channel"})]})}),e.jsx("tbody",{children:c.length>0?c.map(t=>e.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0"},children:[e.jsx("td",{style:{padding:"1rem"},children:new Date(t.timestamp).toLocaleDateString()}),e.jsxs("td",{style:{padding:"1rem",fontWeight:"500"},children:["ðŸ”” ",t.commodity]}),e.jsx("td",{style:{padding:"1rem"},children:e.jsx("div",{style:{fontSize:"0.9rem",color:"#666"},children:t.userId})}),e.jsx("td",{style:{padding:"1rem"},children:t.maxPrice?`â‚¹${t.maxPrice}`:"Any"}),e.jsx("td",{style:{padding:"1rem",fontSize:"0.9rem",color:"#475569"},children:t.district||t.tehsil?`${t.tehsil||""}, ${t.district||""}`:"All Locations"}),e.jsx("td",{style:{padding:"1rem"},children:e.jsx("span",{style:{padding:"2px 8px",borderRadius:"12px",fontSize:"0.8rem",background:"#e0f2fe",color:"#0369a1"},children:t.channel||"app"})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",style:{padding:"2rem",textAlign:"center",color:"#94a3b8"},children:"No active alerts yet. Users can set alerts from the Marketplace page."})})})]})}),s==="users"&&e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",textAlign:"left"},children:[e.jsx("thead",{style:{background:"#f8fafc",color:"#64748b",fontSize:"0.9rem"},children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"1rem"},children:"Join Date"}),e.jsx("th",{style:{padding:"1rem"},children:"Name"}),e.jsx("th",{style:{padding:"1rem"},children:"Phone"}),e.jsx("th",{style:{padding:"1rem"},children:"Location"}),e.jsx("th",{style:{padding:"1rem"},children:"Listings"})]})}),e.jsx("tbody",{children:m.length>0?m.map(t=>e.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0"},children:[e.jsx("td",{style:{padding:"1rem"},children:t.createdAt?new Date(t.createdAt).toLocaleDateString():"N/A"}),e.jsx("td",{style:{padding:"1rem",fontWeight:"500"},children:t.name||"N/A"}),e.jsx("td",{style:{padding:"1rem"},children:t.phone}),e.jsx("td",{style:{padding:"1rem",color:"#475569"},children:t.city||"N/A"}),e.jsx("td",{style:{padding:"1rem",textAlign:"center"},children:o.filter(r=>r.userId===t.uid).length})]},t.uid)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",style:{padding:"2rem",textAlign:"center",color:"#94a3b8"},children:"No users registered yet."})})})]})})]})]})};export{M as default};
